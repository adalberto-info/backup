-- 03/10/2019 - ADALBERTO (WAFX) - MODASP-2413 - 03.19.000 - SCRIPT CRIA CAMPOS ICMS-RESSARCIMENTO. 

------------------------
-- TABELA ENTRADAS_IMPOSTO - 
------------------------
IF NOT EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ENTRADAS_IMPOSTO' AND COLUMN_NAME = 'BASE_ICMS_SUBSTITUTO')
	BEGIN
		ALTER TABLE [DBO].[ENTRADAS_IMPOSTO] ADD [BASE_ICMS_SUBSTITUTO] [numeric] (14, 2) NULL
	END;

IF NOT EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ENTRADAS_IMPOSTO' AND COLUMN_NAME = 'ALIQUOTA')
	BEGIN
		ALTER TABLE [DBO].[ENTRADAS_IMPOSTO] ADD [ALIQUOTA] [numeric] (8, 5) NULL
	END;

IF NOT EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ENTRADAS_IMPOSTO' AND COLUMN_NAME = 'ICMS_PRESUMIDO')
	BEGIN
		ALTER TABLE [DBO].[ENTRADAS_IMPOSTO] ADD [ALIQUOTA] [numeric] (8, 5) NULL
	END;

------------------------
-- TABELA ENTRADAS_ITEM - 
------------------------
IF NOT EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ENTRADAS_ITEM' AND COLUMN_NAME = 'CHAVE_NFE_SUBSTITUTO')
	BEGIN
		ALTER TABLE [DBO].[ENTRADAS_ITEM] ADD [CHAVE_NFE_SUBSTITUTO] [VARCHAR] (44) NULL
	END;

IF NOT EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'ENTRADAS_ITEM' AND COLUMN_NAME = 'SEQ_ITEM_SUBTITUTO')
	BEGIN
		ALTER TABLE [DBO].[ENTRADAS_ITEM] ADD [SEQ_ITEM_SUBSTITUTO] [CHAR] (4) NULL
	END;


------------------------
-- TABELA PRODUTOS - 
------------------------
IF NOT EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PRODUTOS' AND COLUMN_NAME = 'IS_ICMS_SUBSTITUTO')
	BEGIN
		ALTER TABLE [DBO].[PRODUTOS] ADD [IS_ICMS_SUBSTITUTO] [BIT] NOT NULL DEFAULT 0
	END;


------------------------
-- TABELA MATERIAIS - 
------------------------
IF NOT EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'MATERIAIS' AND COLUMN_NAME = 'IS_ICMS_SUBSTITUTO')
	BEGIN
		ALTER TABLE [DBO].[MATERIAIS] ADD [IS_ICMS_SUBSTITUTO] [BIT] NOT NULL DEFAULT 0
	END;


------------------------
-- TABELA DADOS_FECHAMENTO_RESSARCIMENTO - 
------------------------
IF NOT EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'DADOS_FECHAMENTO_RESSARCIMENTO')
	BEGIN
		
		CREATE TABLE [dbo].[DADOS_FECHAMENTO_RESSARCIMENTO](
		[COD_FECHAMENTO] [char](8) NOT NULL,
		[DESC_FECHAMENTO] [varchar](40) NOT NULL,
		[PERIODO] [char](06)  NULL,
		CONSTRAINT [PK_DADOS_FECHAMENTO_RESSARCIMENTO] PRIMARY KEY CLUSTERED 
		(
		[COD_FECHAMENTO] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 100) ON [PRIMARY]
		) ON [PRIMARY]

	END;

------------------------
-- TABELA CONTROLE_ENT_RESSARCIMENTO - 
------------------------
IF NOT EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CONTROLE_ENT_RESSARCIMENTO')
	BEGIN
		
		CREATE TABLE [dbo].[CONTROLE_ENT_RESSARCIMENTO](
		[ID] [INT] IDENTITY(1,1) NOT NULL,
		[EMPRESA] [INT] NOT NULL DEFAULT(0),
		[FILIAL] [varchar](25)  NOT NULL DEFAULT '',
		[NOME_CLIFOR] [varchar](25) NOT NULL DEFAULT '',
		[NF_ENTRADA] [char](15) NOT NULL DEFAULT '',
		[SERIE_NF] [varchar](6) NOT NULL DEFAULT '',
		[CHAVE_NFE] [varchar](44) NOT NULL DEFAULT '',
		[RECEBIMENTO] [datetime] NOT NULL DEFAULT '1900-01-01',
		[VALOR_TOTAL] [numeric](14,2) NOT NULL DEFAULT 0,
		[ITEM] [char](12) NOT NULL DEFAULT '',
		[COR_ITEM] [char](10) NOT NULL DEFAULT '',
		[TAMANHO] [varchar](8) NOT NULL DEFAULT '',
		[QTDE_ENTRADA] [numeric](9,3) NOT NULL DEFAULT 0,
		[ALIQUOTA] [numeric](14,2) NOT NULL DEFAULT 0,
		[BASE_ICMS_ST] [numeric](14,2) NOT NULL DEFAULT 0,
		[ICMS_EFETIVO] [numeric](14,2) NOT NULL DEFAULT 0,
		[ICMS_PRESUMIDO] [numeric](14,2) NOT NULL DEFAULT 0,
		[BASE_ICMS_PRESUMIDO] [numeric](14,2) NOT NULL DEFAULT 0,
		[VALOR_ISENTO] [numeric](14,2) NULL,
		[SEQ_ITEM_SUBTITUTO] [char](4) NOT NULL DEFAULT '',
		[CHAVE_NFE_SUBSTITUTO] [varchar](44) NULL,
		[CODIGO_FISCAL_OPERACAO] [char](4) NOT NULL DEFAULT '',
		[NATUREZA] [char](15) NOT NULL DEFAULT '',
		[SALDO_NF_ENTRADA] [numeric](9,3) NOT NULL DEFAULT 0,
		
		CONSTRAINT [PK_CONTROLE_ENT_RESSARCIMENTO] PRIMARY KEY CLUSTERED 
		(
		[ID] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 100) ON [PRIMARY]
		) ON [PRIMARY]

	END;


------------------------
-- TABELA CONTROLE_SAI_RESSARCIMENTO - 
------------------------
IF NOT EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CONTROLE_SAI_RESSARCIMENTO')
	BEGIN
		
		CREATE TABLE [dbo].[CONTROLE_SAI_RESSARCIMENTO](
		[ID] [INT] IDENTITY(1,1) NOT NULL,
		[EMPRESA] [INT] NOT NULL DEFAULT(0),
		[FILIAL] [varchar](25)  NOT NULL DEFAULT '',
		[NOME_CLIFOR] [varchar](25) NOT NULL DEFAULT '',
		[NF_SAIDA] [char](15) NOT NULL DEFAULT '',
		[SERIE_NF] [varchar](6) NOT NULL DEFAULT '',
		[EMISSAO] [datetime] NOT NULL DEFAULT '1900-01-01 00:00:00',
		[CHAVE_NFE] [varchar](44) NOT NULL DEFAULT '',
		[VALOR_TOTAL] [numeric](14,2) NOT NULL DEFAULT 0,
		[ITEM] [char](12) NOT NULL DEFAULT '',
		[COR_ITEM] [char](10) NOT NULL DEFAULT '',
		[TAMANHO] [varchar](8) NOT NULL DEFAULT '',
		[QTDE_VENDIDA] [numeric](9,3) NOT NULL DEFAULT 0,
		[ALIQUOTA] [numeric](14,2) NOT NULL DEFAULT 0,
		[BASE_ICMS_ST] [numeric](14,2) NOT NULL DEFAULT 0,
		[ICMS_EFETIVO] [numeric](14,2) NOT NULL DEFAULT 0,
		[BASE_ICMS_PRESUMIDO] [numeric](14,2) NOT NULL DEFAULT 0,
		[VALOR_ISENTO] [numeric](14,2) NULL,
		[INDICA_CONSUMIDOR_FINAL] [bit] NOT NULL DEFAULT 0,
		[CODIGO_FISCAL_OPERACAO] [char](4) NOT NULL DEFAULT '',
        [NF_ENTRADA_RELACIONADA] [char](15) NOT NULL DEFAULT '',
		[SERIE_NF_RELACIONADA] [varchar](6) NOT NULL DEFAULT '',
		[NOME_CLIFOR_RELACIONADA] [varchar](25) NOT NULL DEFAULT '',
		[RECEBIMENTO_RELACIONADA] [datetime] NOT NULL DEFAULT '1900-01-01 00:00:00',
		[QTDE] [numeric](9,3) NOT NULL DEFAULT 0,
		[ICMS_EFETIVO] [char](14,2) NOT NULL DEFAULT 0,
		[ICMS_PRESUMIDO] [char](14,2) NOT NULL DEFAULT '',
		[CHAVE_NFE_SUBSTITUTO] [varchar](44) NOT NULL DEFAULT '',
		[SEQ_ITEM_SUBSTITUTO] [char](4) NOT NULL DEFAULT '',
		[COD_FECHAMENTO] [char](8) NOT NULL DEFAULT '',
		CONSTRAINT [PK_CONTROLE_ENT_RESSARCIMENTO] PRIMARY KEY CLUSTERED 
		(
		[ID] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 100) ON [PRIMARY]
		) ON [PRIMARY]

	END;


------------------------
-- TABELA CONTROLE_SALDO_RESSARCIMENTO - 
------------------------
IF NOT EXISTS( SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'CONTROLE_SALDO_RESSARCIMENTO')
	BEGIN
		
		CREATE TABLE [dbo].[CONTROLE_SALDO_RESSARCIMENTO](
		[FILIAL] [varchar](25)  NOT NULL DEFAULT '',
		[COD_FECHAMENTO] [char](8) NOT NULL DEFAULT '',
		[ITEM] [char](12) NOT NULL DEFAULT '',
		[ESTOQUE_INICIAL] [numeric](9,3) NOT NULL DEFAULT 0,
		[ESTOQUE_FINAL] [numeric](9,3) NOT NULL DEFAULT 0,
		[QTDE_MOV] [numeric](9,3) NOT NULL DEFAULT 0,
		[ICMS_EFETIVO] [numeric](14,2) NOT NULL DEFAULT 0,
		[ICMS_PRESUMIDO] [numeric](14,2) NOT NULL DEFAULT 0,
		[COMPL_REST] [numeric](15,5) NOT NULL DEFAULT 0,
		[TOTAL] [numeric](15,5) NOT NULL DEFAULT 0,
		CONSTRAINT [PK_CONTROLE_SALDO_RESSARCIMENTO] PRIMARY KEY CLUSTERED 
		(
		FILIAL, COD_FECHAMENTO, ITEM ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 100) ON [PRIMARY]
		) ON [PRIMARY]

	END;
